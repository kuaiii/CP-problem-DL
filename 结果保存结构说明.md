# 结果保存结构说明

## 新的目录结构

修改后的结果保存结构如下：

```
results/
└── {dataset_name}/
    └── {attack_mode}/
        ├── 1/                          # 实验ID 1
        │   ├── logs/                   # 日志文件
        │   │   └── experiment.log
        │   ├── lcc/                    # LCC指标结果
        │   │   ├── *.csv               # 数据文件
        │   │   ├── *.png               # 图表文件
        │   │   └── ...
        │   ├── csa/                    # CSA指标结果
        │   │   ├── *.csv
        │   │   ├── *.png
        │   │   └── ...
        │   ├── cce/                    # CCE指标结果
        │   │   ├── *.csv
        │   │   ├── *.png
        │   │   └── ...
        │   ├── wcp/                    # WCP指标结果
        │   │   ├── *.csv
        │   │   ├── *.png
        │   │   └── ...
        │   ├── extradata/              # 每次迭代的详细曲线数据
        │   │   └── {method}_iter{ijk}_{attack}_{metric}.csv
        │   └── comprehensive_metrics.csv  # 综合指标汇总
        ├── 2/                          # 实验ID 2
        │   └── ... (同上结构)
        ├── 3/
        │   └── ...
        └── execution_times.csv         # 运行时间统计（所有实验共享）
```

## 主要改进

### 1. 统一实验ID目录
- 所有指标（LCC, CSA, CCE, WCP）的结果都保存在同一个实验ID目录下
- 每个实验ID目录包含该次运行的所有指标结果

### 2. 按指标类型组织子目录
- 每个实验ID目录下，按指标类型创建子目录（`lcc/`, `csa/`, `cce/`, `wcp/`）
- 每个指标目录包含该指标的CSV数据文件和PNG图表文件

### 3. 统一的数据保存位置
- `extradata/`: 保存每次迭代的详细曲线数据
- `comprehensive_metrics.csv`: 保存所有方法的综合指标汇总
- `logs/`: 保存实验日志

## 每个指标目录包含的文件

每个指标目录（如 `lcc/`）包含：

1. **数据文件**:
   - `{dataset}_{attack}_x_values_results.csv`: 崩溃点数据
   - `{dataset}_{attack}_r_values_results.csv`: 鲁棒性R值数据
   - `statistics.csv`: 崩溃点统计（均值、标准差）
   - `r_statistics.csv`: 鲁棒性统计（均值、标准差）

2. **图表文件**:
   - `collapse_point_bar.png`: 崩溃点柱状图
   - `collapse_point_box.png`: 崩溃点箱线图
   - `robustness_bar.png`: 鲁棒性柱状图
   - `robustness_box.png`: 鲁棒性箱线图
   - `{attack_mode}{iteration}.png`: 每次迭代的曲线图

## 代码修改说明

### 主要修改的文件

1. **main.py**:
   - 修改 `run_simulation_batch()`: 改变目录结构，将指标目录放在实验ID下
   - 修改 `setup_experiment_dir()`: 确保日志目录在实验ID下

2. **src/controller/manager.py**:
   - 新增 `_process_method_multi_metric()`: 处理多指标计算
   - 新增 `_run_specific_attack_multi_metric()`: 执行多指标攻击仿真
   - 为每个指标类型分别计算崩溃点和鲁棒性值

### 关键变化

1. **目录结构变化**:
   ```python
   # 旧结构
   results/{dataset}/{attack}/{metric_type}/{experiment_id}/
   
   # 新结构
   results/{dataset}/{attack}/{experiment_id}/{metric_type}/
   ```

2. **多指标计算**:
   - 原来只计算LCC指标
   - 现在同时计算LCC、CSA、CCE、WCP四个指标
   - 每个指标都有独立的崩溃点和鲁棒性值

3. **崩溃点计算**:
   - LCC: 当LCC降到0.2（绝对值）时
   - CSA/CCE/WCP: 当指标降到初始值的20%时

## 使用示例

运行实验后，结果会按以下方式组织：

```bash
# 运行实验
python main.py --dataset GtsCe --attack random --batch_size 5

# 结果结构
results/GtsCe/random/
├── 1/
│   ├── lcc/
│   ├── csa/
│   ├── cce/
│   ├── wcp/
│   ├── extradata/
│   └── comprehensive_metrics.csv
├── 2/
│   └── ...
└── execution_times.csv
```

## 优势

1. **更好的组织性**: 每次实验的所有结果都在一个目录下，便于查找和对比
2. **完整性**: 所有指标的结果都保存在一起，不会遗漏
3. **可追溯性**: 每次实验都有独立的ID，便于版本管理和结果对比
4. **灵活性**: 可以轻松添加新的指标类型，只需在`metric_types`列表中添加即可
